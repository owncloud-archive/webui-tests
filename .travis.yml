language: php
python:
    - "5.4"

env:
    - CORE_BRANCH=stable8
  global:
    - secure: svI7A2V7c9E1GRnwYK60hvdHN8PCky2XTxlVG/sS5vpk65YuinTe6ppaco7aKS/ZJW6y3PNDMYV8tscYFro0GQ1hP2ai5gbIYhyUwP+eyMfLTZm0nfmB9pbj6B8vTjFNVPhOm/OBK+SLs06lSNrJsh16BHhXTSVsvnAZA1ioUolwD9nDm2OsGBwuzKtCP5MsywEUTlTWsEtBccgfi7p6o7VGJOeII/gQM9mWGacg1xZ/LpvyPoWg9tU4kWblN8v5++kOKeHEHuXMW6VEsuly6PhQP4cyoSMWZ7tS66c7cQQdXFcGPnkygilXmEr46EzdKZg1hjQYgM6OUB6vMqlapu3ZBDCLFCO5iyRvRzdbtmfQ00iuxIicPv8zZio963QIboo3sbE7ih2eI3JAlr1VwY7xus/vTiq//BmVgt69+xDG3b60WoEKW/rQWrmiYhoHSmBH6hjPPgAzb6f8LoBIuGWwUJsdyAsT740VghXoo89D/+nTJg+QT78taL/Me8+3uWxi+SucqE0kAAIjJ5F7n5ENnxu0Jh1QE2f5itAeIDzzQW3oVEYFTwy373ycQd9B7pGox7gVcpn+uNmVM3X13kLjTOSMr4hK5iCw46mlWYM8TrySkNYui55GjZ2CbSCV7YqU4zLdB6gMmY5OenJWxkPcervqiTacI7Vb4TrkZAE=
    - secure: i6seo3Vzb7mAUZO5jcPnBgsOhQCeX3J5F7NW8LLZ2Xsae6PQ8C0G601ez0loIsLOJx4TBQVV5lHh1+24w0bby/PQ5NGmP10DvRosKq+KvCa1SKmP5TQUt4l5ihkaipoT7mNQMFtaNG5zswKSd28hvSNewTOaZCNZ5aTb2dKELG8z4sgLGlkjAfpjMTSFrk1+fY/9tPF3jFynDUh4lh6SCXwJjpJyhlAsefNWsHHHJzA7j/tDHPTHNXzTLl6tAB9O7vLF65iuj7SAjugCPBoKpoNGY1rQE2r1eYjO589e7+0YuAmdJjLq0JmBlHKt+3HdHzSIWG6nNai/sTbSbvElRi+wz7COpwJtLIQdNCje8ZT0u2A1S5YT8IR8PWKI44Bmr5DWTe6xqAp+rNI2HMc1nrD69MCb1FFkA60UWI1QYWrEyc2fxM4fg/THMSV9haryUddAJLyPq+IK4lbE/lFJxYKqyHCV27/kiN+JWdMgi65hrj/ThrMXhs5OZDcDZYC7VhbZxP+xo4TTtWZ9SVvB+jcOkin0hmNW2+zVYM4BsrdOmxom8D5prZqaQUzAWuhlAIx2Q/QQSWMVcAy1F2WEF8RK+4JFoxugPdTTY+hNZ7xuewYPS2q9g/8lrLCN79ifPYOV30ar1KyYonnHaHuJ+Em6mc00nMIiW53L23/L23c=


addons:
  sauce_connect: true

before_install:
    - sudo apt-get update
    - sudo apt-get install apache2 libapache2-mod-fastcgi curl
    - bash travis-build/install_oc.sh $CORE_BRANCH
    # enable php-fpm
    - sudo cp ~/.phpenv/versions/$(phpenv version-name)/etc/php-fpm.conf.default ~/.phpenv/versions/$(phpenv version-name)/etc/php-fpm.conf
    - sudo a2enmod rewrite actions fastcgi alias
    - echo "cgi.fix_pathinfo = 1" >> ~/.phpenv/versions/$(phpenv version-name)/etc/php.ini
    - ~/.phpenv/versions/$(phpenv version-name)/sbin/php-fpm
    # configure apache virtual hosts
    - sudo cp -f travis-build/travis-ci-apache /etc/apache2/sites-available/default
    - sudo sed -e "s?%TRAVIS_BUILD_DIR%?$(pwd)?g" --in-place /etc/apache2/sites-available/default
    - sudo service apache2 restart
    - sleep 3
    - chmod +x core/occ
    - ./core/occ app:disable firstrunwizard
install: 
    - mv travis-build/config.py.travis config.py
    - cd sauce
    - sudo pip install -r sauce_requirements.txt

script: ./run_sauce_tests.sh
